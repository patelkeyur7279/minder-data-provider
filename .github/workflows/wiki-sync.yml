name: Sync Wiki

on:
  push:
    branches:
      - dev
    paths:
      - 'docs/**'

jobs:
  sync:
    runs-on: ubuntu-latest
      - uses: actions/checkout@v4
      - name: Sync Wiki
        run: |
          echo "Configuring git..."
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"

          echo "Cloning wiki repo..."
          # Clone the wiki repository
          git clone "https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.wiki.git" wiki_repo

          echo "Syncing files..."
          # Clean wiki repo (except .git) to ensure deleted files are removed
          cd wiki_repo
          find . -maxdepth 1 ! -name '.git' ! -name '.' ! -name '..' -exec rm -rf {} +
          cd ..

          # Copy docs content to wiki repo
          cp -a docs/. wiki_repo/

          echo "Committing changes..."
          cd wiki_repo
          git add .
          # Only commit if there are changes
          if ! git diff-index --quiet HEAD; then
            git commit -m "docs: sync from dev [skip ci]"
            git push origin master
            echo "Wiki updated successfully."
          else
            echo "No changes to sync."
          fi
